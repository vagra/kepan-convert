#1 Kepan Convert

这是一个佛经科判转换工具。

它用来解决一个痛点。就是 Word 和 PDF 通常只能支持六级或九级标题的问题，这么几级标题用来做科判远远不够，于是大家被迫去寻找新的工具。

现在大家慢慢都习惯用幕布大纲或者 XMind 思维导图的方式来制作佛经科判了，但是它们的阅读体验，似乎又不如传统的 Word 和 PDF 方便。

传统的 Word 和 PDF 的阅读方式，是树形的大纲、平板的正文，正文只需要上下滚动而不需要左右滚动，于是用鼠标滚轮就可以方便地控制。

现在幕布和 XMind 都可以导出为 OPML 大纲文件，导出来以后，传到这个网站，按照步骤把 OPML 转换为 MD ，再转换为 HTML ，再转换为 PDF 。

这里的 MD ，是经过扩展的、支持一百零八级标题的 Markdown 语法格式，它用 `#1, #2, #3 ... #108` 代替 Markdown 本来的 `#, ##, ### ... ######` 来表示各级标题，从而突破了 Markdown 语法只能表示六级标题的先天限制。

然后转换为 HTML 时，各级标题分别表示为 `<h1>, <h2>, <h3> ... <h108>` ，从而使得 HTML 文件也可以使用一百零八级标题。

于是到最终转换为 PDF 的时候，一样可以支持一百零八级标题。


#2 工作流程

OPML → MD → HTML → PDF

科判制作经验流程：
![科判工作流程](//kepan.org/repo/img/workflow.png)

#3 第一步：导出和上传 OPML

#4 从幕布或 XMind 导出 OPML 文件

注意这里对幕布大纲或者 XMind 思维导图的结构有要求：

OPML 转换为 MD 时，若一个节点没有子节点，就把它判断为正文；若一个节点有子节点，就把它判断为标题。

> 幕布文档示例:
> [​大乘起信论科判](https://mubu.com/doc/mZYaspo8x0)
> [楞严经玄义科判](https://mubu.com/doc/8xgmui2hi-)

1. 在幕布中，点击右上角的 `三点` 按钮，在弹出菜单中选择 `导出/下载` ：
![幕布导出步骤一](//kepan.org/repo/img/mubu-export-1.jpg)

2. 然后点击 `OPML` 即可下载 OPML 文件：
![幕布导出步骤二](//kepan.org/repo/img/mubu-export-2.jpg)

#4 上传 OPML 文件到这里

访问 https://kepan.org/convert ，注册、登录。

点击 `上传文件` 按钮来上传 OPML 文件：
> ![上传 OPML 文件](//kepan.org/repo/img/upload-opml-1.jpg)

或者直接拖放 OPML 文件到浏览器页面即可上传：
> ![上传 OPML 文件](//kepan.org/repo/img/upload-opml-2.jpg)

支持同时上传多个文件。

#3 第二步：转换 OPML 到 MD

OPML 文件右边有个 `转为 MD` 按钮，点击即可将其转换为 MD 文件。

MD 文件右边有个 `眼睛` 按钮，点击可以用 docsify 打开 MD 文件看效果，带侧边栏。

#3 第三步：转换 MD 到 HTML

MD 文件右边有个 `转为 HTML` 按钮，点击即可将其转换为 HTML 文件，同时生成一个 print-vue.css 样式文件。

HTML 文件右边有个 `眼睛` 按钮，点击可以直接在浏览器中打开该 HTML 文件看效果，这个 HTML 文件是用于下一步转换为 PDF 的，所以不带侧边栏。

点击 print-vue.css 文件可以简单修改该文件，它控制 HTML 和最终生成的 PDF 文档的外观。

#3 第四步：转换 HTML 到 PDF

HTML 文件右边有个 `转为 PDF` 按钮，点击即可将其转换为 PDF 文件，运行中的一些警告、报错信息会输出到同目录下的 output.txt 。

经过这样一番操作，会有这些文件：
> ![最终文件列表](//kepan.org/repo/img/list.jpg)

PDF 文件右边也有个 `眼睛` 按钮，点击可以直接在浏览器中打开 PDF 看效果。

不过，浏览器自带的 PDF 阅读器体验并不是最好的，推荐把 PDF 下载下来，用 PDF-XChange Viewer 来阅读，体验非常好。

#2 在线编辑

网站有简单的在线编辑功能，支持编辑 `MD, HTML, CSS, TXT` 格式的文件。

在列表中点击文件名，会打开一个在线编辑器，你可以修改文件内容，修改后点击 `保存` 按钮就可以原地保存。

#2 支持图片

如果你的 MD 文件中引用了图片，你可以创建一个文件夹，把图片都传进去，那么把 MD 转换为 HTML 和 PDF 的话，图片也可以显示。

Markdown 插入图片的语法是：
```
![说明文字](/目录/文件名.jpg)
```

#2 字体支持

由于文件是在服务器上进行转换，在转换为 PDF 时，服务器上没有的字体，就不会内嵌到 PDF 里。目前服务器上的中文字体并不多，基本上都是思源字体，这些字体已经写在默认的 print-vue.css 里面了：
```
Source Han Sans SC  // 思源黑体
Source Han Sans TC  // 思源黑體
Source Han Serif SC // 思源宋体
Source Han Serif TC // 思源宋體
Source Han Mono SC  // 思源等宽
Source Han Mono TC  // 思源等寬
Source Sans Pro     // 英文无衬线
Source Serif Pro    // 英文衬线
Source Code Pro     // 英文等宽
```

但是，这个 PDF 转换器可以支持 css 的内嵌字体，所以你可以在 css 中内嵌谷歌中文字体之类，如果你会的话。

使用 css 的内嵌字体时，会联网获取远程字体，所以要多花十来秒钟。

#2 本地工具

这个在线转换工具的设计初衷，是为了让不熟悉技术的人们也可以方便地转换，同时尽量给他们提供最大的自由度。一般来说如果定制需求不是太多，用这个在线转换工具就够了。

在线转换工具的主要限制，就是前面说的，嵌入字体受限。如果一个字体，服务器上没有，谷歌字库里也没有，它就不方便嵌入。

如果你了解一些技术，最起码会安装和使用 Python 的话，下一步我会把这个转换工具链制作一些 Python 脚本，这样大家就可以在自己的电脑上使用了。

#2 免责声明

!> 这个网站的用途是作为转换工具，而不是作为发布平台，每个人注册以后会有自己专用的个人文件夹，方便做各种操作，这样可以非常自由。文件转换好了以后，你自己下载保存。服务器不会永久保存，基本上大概一周，或者一个月左右没有登陆的话，你的个人文件夹就会自动清空。
